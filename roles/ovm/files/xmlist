find /OVS/Repositories -name vm.cfg -print | xargs grep -H OVM_simple_name | { cat -; ps -ef | grep qemu-dm | grep -v grep; netstat -anp | grep 'LISTEN.*qemu-dm'; xm list; } | awk --source '/^Domain-0/ {print;next} /^Name/ {print $0 " VM Name         VNC port";next} /OVM_simple_name/ { split($0, arrid, "/"); split($0, arr, ":"); split(arr[2], arr2, "="); tabel[arrid[6]] = substr(arr2[2], 3, length(arr2[2]) - 3); next} /qemu.*-domain-name/ { split($0,arr,"-domain-name "); split(arr[2], arr2, " "); tabel2[arr2[1]] = $2; next } / LISTEN/ { split($7, arr, "/"); split($4, arr2, ":"); tabel3[arr[1]] = arr2[2]; next } {print $0 "  " substr(tabel[$1] "          ", 1, 15) " " tabel3[tabel2[$1]] }'
